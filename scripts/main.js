"use strict";function checkTime(e){return e<10&&(e="0"+e),e}function startTime(){var e=new Date,t=e.getHours(),n=e.getMinutes(),i=e.getSeconds();n=checkTime(n),i=checkTime(i),document.getElementById("currentTime").innerHTML=t+":"+n+":"+i;setTimeout(function(){startTime()},500)}function calculateAspectRatioFit(e,t,n,i){var o=Math.min(n/e,i/t);return{width:e*o,height:t*o}}function applyWidthAndHeight(){for(var e=getSize(document.querySelector(".sheet")),t=calculateAspectRatioFit(200,283,e.width,e.height),n=document.querySelectorAll(".sheet__ratio"),i=0;i<n.length;i++)n[i].style.width=t.width+"px",n[i].style.height=t.height+"px"}function handlePublicationBrowsing(e){var t=e.target.closest(".sheet"),n=t.nextElementSibling;if(void 0===n||!n){n=t.parentNode.children[0]}t.classList.add("isMovingOffscreen"),n.classList.add("isCurrent"),t.addEventListener("transitionend",function(e){t.classList.remove("isCurrent"),t.classList.remove("isMovingOffscreen")},!1)}function setupPublicationBtns(){for(var e=document.querySelectorAll(".js-nextPublication"),t=0;t<e.length;t++)e[t].addEventListener("click",function(e){handlePublicationBrowsing(e)})}function openIndex(){for(var e=document.querySelectorAll(".btn--index"),t=0;t<e.length;t++)e[t].classList.toggle("isHidden");for(var n=document.querySelectorAll(".sheet--publication"),t=0;t<n.length;t++)n[t].classList.contains("isCurrent")?n[t].classList.add("isFlipped"):n[t].classList.add("isHidden")}function setupOpenIndexBtn(){for(var e=document.querySelectorAll(".js-openIndex"),t=0;t<e.length;t++)e[t].addEventListener("click",function(e){openIndex(e)})}function closeIndex(){for(var e=document.querySelectorAll(".btn--index"),t=0;t<e.length;t++)e[t].classList.toggle("isHidden");var n=document.querySelector(".sheet--publication.isCurrent");n.classList.remove("isFlipped"),n.addEventListener("transitionend",function(e){for(var t=document.querySelectorAll(".sheet--publication"),n=0;n<t.length;n++)t[n].classList.remove("isHidden")},!1)}function setupCloseIndexBtn(){for(var e=document.querySelectorAll(".js-closeIndex"),t=0;t<e.length;t++)e[t].addEventListener("click",function(e){closeIndex(e)})}function populateIndex(){for(var e=[],t=document.querySelectorAll(".sheet--publication"),n=0;n<t.length;n++){var i=[],o=t[n].querySelector(".publication__number"),r=t[n].querySelector(".publication__title"),d=t[n].querySelector(".publication__author");i.push(o.innerHTML),i.push(r.innerHTML),i.push(d.innerHTML),e.push(i)}for(var s=document.querySelectorAll(".sheet__back"),n=0;n<s.length;n++){var l=s[n].querySelector(".sheet__content"),a=document.createElement("span");a.classList.add("heading--index"),a.innerHTML="(Index)",l.appendChild(a);for(var n=0;n<e.length;n++){var c=document.createElement("div");c.classList.add("publication");var u=document.createElement("span");u.innerHTML=e[n][0]+". ",c.appendChild(u);var p=document.createElement("span");p.innerHTML=e[n][1],c.appendChild(p);var m=document.createElement("span");m.innerHTML=" â€“ "+e[n][2],c.appendChild(m),l.appendChild(c)}}}function handleInitialLoad(){setTimeout(function(){var e=document.querySelector(".sheet--splash"),t=document.querySelector(".js-openIndex"),n=e.closest(".sheet"),i=n.nextElementSibling;n.classList.add("isMovingOffscreen"),i.classList.add("isCurrent"),n.addEventListener("transitionend",function(e){n.parentNode.removeChild(n),t.classList.remove("isHidden"),t.addEventListener("transitionend",function(e){t.classList.remove("fade")},!1)},!1)},2e3)}function handleCounts(e,t){for(var n=0;n<t.length;n++){var i=document.getElementById("objectCount_"+t[n].item_id);i&&updateCount(t[n].item_id,t[n].count)}}function printBtnListener(e){e.preventDefault();var t=e.currentTarget.id.split("_")[1];e.currentTarget.hasAttribute("data-link")?handlePDFResponse(t,{link:e.currentTarget.getAttribute("data-link"),count:100-parseInt(document.getElementById("objectCount_"+t).innerText)},!0):getRequest("https://r0l405b0oj.execute-api.eu-central-1.amazonaws.com/prod/link?id="+t,t,handlePDFResponse)}function getRequest(e,t,n){var i=new XMLHttpRequest;i.open("GET",e),i.responseType="json",i.onload=function(e){if(200===this.status){var i=this.response;n(t,i)}},i.send()}function handlePDFResponse(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i="pdf/"+t.link.split("_")[0]+"/"+t.link,o=t.count;document.getElementById("hidden-pdf").addEventListener("load",iframeLoadedListener),document.getElementById("hidden-pdf").src=i,updateCount(e,o),n||(localStorage.setItem(e,t.link),document.getElementById("print_"+e).setAttribute("data-link",t.link))}function iframeLoadedListener(e){window.frames["hidden-pdf"].print(),document.getElementById("hidden-pdf").removeEventListener("load",iframeLoadedListener)}function updateCount(e,t){document.getElementById("objectCount_"+e).innerText=100-t+""}var objects=document.querySelectorAll(".sheet--publication");[].forEach.call(objects,function(e){null!==localStorage.getItem(e.id.split("_")[1])&&(document.getElementById("alreadyOwns_"+e.id.split("_")[1]).removeAttribute("style"),document.getElementById("print_"+e.id.split("_")[1]).setAttribute("data-link",localStorage.getItem(e.id.split("_")[1])))}),document.addEventListener("DOMContentLoaded",function(e){applyWidthAndHeight(),startTime(),setupPublicationBtns(),setupOpenIndexBtn(),setupCloseIndexBtn(),handleInitialLoad(),populateIndex();var t=document.querySelectorAll(".js-printPublication");[].forEach.call(t,function(e){e.addEventListener("click",printBtnListener)}),getRequest("https://r0l405b0oj.execute-api.eu-central-1.amazonaws.com/prod/status",{},handleCounts)}),window.addEventListener("resize",function(e){applyWidthAndHeight()});