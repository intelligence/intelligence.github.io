"use strict";function checkTime(e){return e<10&&(e="0"+e),e}function startTime(){var e=new Date,t=e.getHours(),n=e.getMinutes(),i=e.getSeconds();n=checkTime(n),i=checkTime(i),document.getElementById("currentTime").innerHTML=t+":"+n+":"+i;setTimeout(function(){startTime()},500)}function calculateAspectRatioFit(e,t,n,i){var s=Math.min(n/e,i/t);return{width:e*s,height:t*s}}function applyWidthAndHeight(){for(var e=getSize(document.querySelector(".sheet")),t=calculateAspectRatioFit(200,283,e.width,e.height),n=document.querySelectorAll(".sheet__ratio"),i=0;i<n.length;i++)n[i].style.width=t.width+"px",n[i].style.height=t.height+"px"}function handlePublicationBrowsing(e){var t=e.target.closest(".sheet"),n=t.nextElementSibling;if(void 0===n||!n){n=t.parentNode.children[0]}t.classList.add("isMovingOffscreen"),n.classList.add("isCurrent"),setTimeout(function(){t.classList.remove("isCurrent"),t.classList.remove("isMovingOffscreen")},500)}function setupPublicationBtns(){for(var e=document.querySelectorAll(".js-nextPublication"),t=0;t<e.length;t++)e[t].addEventListener("click",function(e){handlePublicationBrowsing(e)})}function openIndex(){for(var e=document.querySelectorAll(".btn--index"),t=0;t<e.length;t++)e[t].classList.toggle("isHidden"),setTimeout(function(){document.querySelector(".js-closeIndex").classList.remove("isNotClickable"),document.querySelector(".js-openIndex").classList.add("isNotClickable")},500);for(var n=document.querySelectorAll(".sheet--publication"),t=0;t<n.length;t++)n[t].classList.contains("isCurrent")?n[t].classList.add("isFlipped"):n[t].classList.add("isHidden")}function setupOpenIndexBtn(){for(var e=document.querySelectorAll(".js-openIndex"),t=0;t<e.length;t++)e[t].addEventListener("click",function(e){openIndex(e)})}function closeIndex(){for(var e=document.querySelectorAll(".btn--index"),t=0;t<e.length;t++)e[t].classList.toggle("isHidden"),setTimeout(function(){document.querySelector(".js-closeIndex").classList.add("isNotClickable"),document.querySelector(".js-openIndex").classList.remove("isNotClickable")},500);document.querySelector(".sheet--publication.isCurrent").classList.remove("isFlipped"),setTimeout(function(){for(var e=document.querySelectorAll(".sheet--publication"),t=0;t<e.length;t++)e[t].classList.remove("isHidden")},500)}function setupCloseIndexBtn(){for(var e=document.querySelectorAll(".js-closeIndex"),t=0;t<e.length;t++)e[t].addEventListener("click",function(e){closeIndex(e)})}function getElementIndex(e){for(var t=0;e=e.previousElementSibling;)t++;return t}function revealPreview(e){var t=e.target.closest(".sheet"),n=getElementIndex(t),i=t.closest(".stack"),s=i.children.length,o=s-n,r=previewObject[o],c=document.querySelector(".sheet--info"),d=document.createElement("div");if(d.classList.add("sheet__preview"),"text"==r.type)d.innerHTML=r.content,d.classList.add("isText");else if("image"==r.type){var l=document.createElement("img");l.classList.add("img-fluid"),l.src=r.content,d.appendChild(l),d.classList.add("isImage")}c.querySelector(".sheet__inner").appendChild(d),c.querySelector(".sheet__content").classList.add("isHidden")}function removePreview(e){var t=document.querySelector(".sheet--info");t.querySelector(".sheet__content").classList.remove("isHidden");var n=t.querySelector(".sheet__preview");n.parentNode.removeChild(n)}function setupPreviewBtns(){for(var e=document.querySelectorAll(".js-preview"),t=0;t<e.length;t++)e[t].addEventListener("mouseenter",function(e){revealPreview(e)}),e[t].addEventListener("mouseleave",function(e){removePreview(e)})}function goToPublication(e){var t=e.target.closest(".publication"),n=getElementIndex(t),i=document.querySelector(".sheet--publication.isCurrent.isFlipped"),s=document.querySelectorAll(".sheet--publication");i!=s[n]&&(s[n].classList.add("isCurrent"),s[n].classList.add("isFlipped"),s[n].classList.remove("isHidden"),i.classList.add("isHidden"),i.classList.remove("isFlipped"),i.classList.remove("isCurrent")),setTimeout(function(){closeIndex()},75)}function setupGoToBtns(){for(var e=document.querySelectorAll(".js-goToPublication"),t=0;t<e.length;t++)e[t].addEventListener("click",function(e){goToPublication(e)})}function populateIndex(){for(var e=[],t=document.querySelectorAll(".sheet--publication"),n=0;n<t.length;n++){var i=[],s=t[n].querySelector(".publication__number"),o=t[n].querySelector(".publication__title"),r=t[n].querySelector(".publication__author");o=o.innerHTML.replace("<br>"," "),i.push(s.innerHTML),i.push(o),i.push(r.innerHTML),e.push(i)}for(var c=document.createElement("div"),n=0;n<e.length;n++){var d=document.createElement("div");d.classList.add("publication"),d.classList.add("js-goToPublication");var l=document.createElement("span");l.innerHTML=e[n][0]+". ",d.appendChild(l);var a=document.createElement("span");a.innerHTML=e[n][1],d.appendChild(a);var u=document.createElement("span");u.innerHTML=" â€“ "+e[n][2],d.appendChild(u),c.appendChild(d)}for(var p=document.querySelectorAll(".sheet--publication .sheet__back"),n=0;n<p.length;n++){var m=p[n].querySelector(".sheet__content"),h=document.createElement("span");h.classList.add("heading--index"),h.innerHTML="Index",m.appendChild(h),m.appendChild(c.cloneNode(!0))}setupGoToBtns()}function handleInitialLoad(){setTimeout(function(){var e=document.querySelector(".sheet--splash"),t=document.querySelector(".js-openIndex"),n=e.closest(".sheet"),i=n.nextElementSibling;n.classList.add("isMovingOffscreen"),i.classList.add("isCurrent"),n.addEventListener("transitionend",function(e){n.parentNode.removeChild(n),t.classList.remove("isHidden"),t.addEventListener("transitionend",function(e){t.classList.remove("fade")},!1)},!1)},2e3)}function handleInitialLoadFlip(){for(var e=document.querySelectorAll(".sheet--publication"),t=0;t<e.length;t++)e[t].classList.add("isHidden");var n=e[0].querySelector(".sheet__front .sheet__content");document.querySelector(".sheet--splash").querySelector(".sheet__back").appendChild(n.cloneNode(!0)),setTimeout(function(){var t=document.querySelector(".js-openIndex"),n=document.querySelector(".sheet--splash");n.classList.add("isFlipped"),setTimeout(function(){t.classList.remove("isHidden"),t.addEventListener("transitionend",function(i){t.classList.remove("fade");for(var s=0;s<e.length;s++)e[s].classList.remove("isHidden");var o=e[0].id.split("_")[1],r=document.getElementById("objectCount_"+o);e[0].querySelector("#objectCount_"+o).innerHTML=r.innerHTML,e[0].classList.add("isCurrent"),n.parentNode.removeChild(n)},!1)},500)},2e3)}function handleCounts(e,t){for(var n=0;n<t.length;n++){document.getElementById("objectCount_"+t[n].item_id)&&updateCount(t[n].item_id,t[n].count)}}function printBtnListener(e){e.preventDefault();var t=e.currentTarget.id.split("_")[1];e.currentTarget.classList.add("preparing"),e.currentTarget.hasAttribute("data-link")?handlePDFResponse(t,{link:e.currentTarget.getAttribute("data-link"),count:100-parseInt(document.getElementById("objectCount_"+t).innerText)},!0):getRequest("https://r0l405b0oj.execute-api.eu-central-1.amazonaws.com/prod/link?id="+t,t,handlePDFResponse)}function getRequest(e,t,n){var i=new XMLHttpRequest;i.open("GET",e),i.responseType="json",i.onload=function(e){if(200===this.status){var i=this.response;n(t,i)}},i.send()}function handlePDFResponse(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i="/pdfs/"+e+"/"+t.link,s=t.count;document.getElementById("hidden-pdf").addEventListener("load",iframeLoadedListener),document.getElementById("hidden-pdf").src=i,updateCount(e,s),n||(localStorage.setItem(e,t.link),document.getElementById("print_"+e).setAttribute("data-link",t.link))}function iframeLoadedListener(e){document.querySelector(".preparing")&&document.querySelector(".preparing").classList.remove("preparing"),window.frames["hidden-pdf"].print(),document.getElementById("hidden-pdf").removeEventListener("load",iframeLoadedListener)}function updateCount(e,t){document.getElementById("objectCount_"+e).innerText=100-t+""}document.addEventListener("DOMContentLoaded",function(e){applyWidthAndHeight(),startTime(),setupPublicationBtns(),setupOpenIndexBtn(),setupCloseIndexBtn(),setupPreviewBtns(),populateIndex(),handleInitialLoadFlip();var t=document.querySelectorAll(".js-printPublication");[].forEach.call(t,function(e){e.addEventListener("click",printBtnListener)}),getRequest("https://r0l405b0oj.execute-api.eu-central-1.amazonaws.com/prod/status",{},handleCounts)}),window.addEventListener("resize",function(e){applyWidthAndHeight()});